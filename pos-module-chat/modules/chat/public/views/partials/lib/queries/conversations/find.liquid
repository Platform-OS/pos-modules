{% liquid
  if id == blank
    log 'Something went wrong. id is null', type: 'ERROR'
    return null
  endif

  graphql r = 'modules/chat/conversations/search', limit: 1, id: id, participant_id: participant_id, include_messages: include_messages

  assign conversation = r.conversations.results.first

  assign participants = '[]' | parse_json


  # platformos-check-disable GraphqlInForLoop
  for participant_id in conversation.participant_ids
    function profile = 'modules/user/queries/profiles/find', id: participant_id, user_id: null, uuid: null, first_name: null, last_name: null
    assign participants = participants | add_to_array: profile
  endfor
  # platformos-check-enable GraphqlInForLoop

  hash_assign conversation['participants'] = participants

  return conversation
%}
